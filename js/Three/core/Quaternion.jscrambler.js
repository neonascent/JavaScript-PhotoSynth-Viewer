THREE.Quaternion=function(a,c,b,d){this.set(a||0,c||0,b||0,d!==undefined?d:1)};THREE.Quaternion.prototype={constructor:THREE.Quaternion,set:function(a,c,b,d){this.x=a;this.y=c;this.z=b;this.w=d;return this},copy:function(a){this.x=a.x;this.y=a.y;this.z=a.z;this.w=a.w;return this},setFromEuler:function(a){var c=0.5*Math.PI/360,b=a.x*c,d=a.y*c,e=a.z*c,i=Math.cos(d),h=Math.sin(d),f=Math.cos(-e),g=Math.sin(-e),j=Math.cos(b),k=Math.sin(b),l=i*f,m=h*g;this.w=l*j-m*k;this.x=l*k+m*j;this.y=h*f*j+i*g*k;this.z=i*g*j-h*f*k;return this},setFromAxisAngle:function(a,c){var b=c/2,d=Math.sin(b);this.x=a.x*d;this.y=a.y*d;this.z=a.z*d;this.w=Math.cos(b);return this},setFromRotationMatrix:function(b){function d(a,c){return c<0?-Math.abs(a):Math.abs(a)}var e=Math.pow(b.determinant(),1.0/3.0);this.w=Math.sqrt(Math.max(0,e+b.n11+b.n22+b.n33))/2;this.x=Math.sqrt(Math.max(0,e+b.n11-b.n22-b.n33))/2;this.y=Math.sqrt(Math.max(0,e-b.n11+b.n22-b.n33))/2;this.z=Math.sqrt(Math.max(0,e-b.n11-b.n22+b.n33))/2;this.x=d(this.x,(b.n32-b.n23));this.y=d(this.y,(b.n13-b.n31));this.z=d(this.z,(b.n21-b.n12));this.normalize();return this},calculateW:function(){this.w=-Math.sqrt(Math.abs(1.0-this.x*this.x-this.y*this.y-this.z*this.z));return this},inverse:function(){this.x*=-1;this.y*=-1;this.z*=-1;return this},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},normalize:function(){var a=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);if(a==0){this.x=0;this.y=0;this.z=0;this.w=0}else{a=1/a;this.x=this.x*a;this.y=this.y*a;this.z=this.z*a;this.w=this.w*a}return this},multiplySelf:function(a){var c=this.x,b=this.y,d=this.z,e=this.w,i=a.x,h=a.y,f=a.z,g=a.w;this.x=c*g+e*i+b*f-d*h;this.y=b*g+e*h+d*i-c*f;this.z=d*g+e*f+c*h-b*i;this.w=e*g-c*i-b*h-d*f;return this},multiply:function(a,c){this.x=a.x*c.w+a.y*c.z-a.z*c.y+a.w*c.x;this.y=-a.x*c.z+a.y*c.w+a.z*c.x+a.w*c.y;this.z=a.x*c.y-a.y*c.x+a.z*c.w+a.w*c.z;this.w=-a.x*c.x-a.y*c.y-a.z*c.z+a.w*c.w;return this},multiplyVector3:function(a,c){if(!c){c=a}var b=a.x,d=a.y,e=a.z,i=this.x,h=this.y,f=this.z,g=this.w,j=g*b+h*e-f*d,k=g*d+f*b-i*e,l=g*e+i*d-h*b,m=-i*b-h*d-f*e;c.x=j*g+m*-i+k*-f-l*-h;c.y=k*g+m*-h+l*-i-j*-f;c.z=l*g+m*-f+j*-h-k*-i;return c}};THREE.Quaternion.slerp=function(a,c,b,d){var e=a.w*c.w+a.x*c.x+a.y*c.y+a.z*c.z;if(Math.abs(e)>=1.0){b.w=a.w;b.x=a.x;b.y=a.y;b.z=a.z;return b}var i=Math.acos(e),h=Math.sqrt(1.0-e*e);if(Math.abs(h)<0.001){b.w=0.5*(a.w+c.w);b.x=0.5*(a.x+c.x);b.y=0.5*(a.y+c.y);b.z=0.5*(a.z+c.z);return b}var f=Math.sin((1-d)*i)/h,g=Math.sin(d*i)/h;b.w=(a.w*f+c.w*g);b.x=(a.x*f+c.x*g);b.y=(a.y*f+c.y*g);b.z=(a.z*f+c.z*g);return b};