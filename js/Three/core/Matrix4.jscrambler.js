THREE.Matrix4=function(a,c,b,e,g,f,d,h,i,j,k,o,n,l,p,q){this.set(a||1,c||0,b||0,e||0,g||0,f||1,d||0,h||0,i||0,j||0,k||1,o||0,n||0,l||0,p||0,q||1);this.flat=new Array(16);this.m33=new THREE.Matrix3()};THREE.Matrix4.prototype={constructor:THREE.Matrix4,set:function(a,c,b,e,g,f,d,h,i,j,k,o,n,l,p,q){this.n11=a;this.n12=c;this.n13=b;this.n14=e;this.n21=g;this.n22=f;this.n23=d;this.n24=h;this.n31=i;this.n32=j;this.n33=k;this.n34=o;this.n41=n;this.n42=l;this.n43=p;this.n44=q;return this},identity:function(){this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return this},copy:function(a){this.set(a.n11,a.n12,a.n13,a.n14,a.n21,a.n22,a.n23,a.n24,a.n31,a.n32,a.n33,a.n34,a.n41,a.n42,a.n43,a.n44);return this},lookAt:function(a,c,b){var e=THREE.Matrix4.__v1,g=THREE.Matrix4.__v2,f=THREE.Matrix4.__v3;f.sub(a,c).normalize();if(f.length()===0){f.z=1}e.cross(b,f).normalize();if(e.length()===0){f.x+=0.0001;e.cross(b,f).normalize()}g.cross(f,e).normalize();this.n11=e.x;this.n12=g.x;this.n13=f.x;this.n21=e.y;this.n22=g.y;this.n23=f.y;this.n31=e.z;this.n32=g.z;this.n33=f.z;return this},multiplyVector3:function(a){var c=a.x,b=a.y,e=a.z,g=1/(this.n41*c+this.n42*b+this.n43*e+this.n44);a.x=(this.n11*c+this.n12*b+this.n13*e+this.n14)*g;a.y=(this.n21*c+this.n22*b+this.n23*e+this.n24)*g;a.z=(this.n31*c+this.n32*b+this.n33*e+this.n34)*g;return a},multiplyVector4:function(a){var c=a.x,b=a.y,e=a.z,g=a.w;a.x=this.n11*c+this.n12*b+this.n13*e+this.n14*g;a.y=this.n21*c+this.n22*b+this.n23*e+this.n24*g;a.z=this.n31*c+this.n32*b+this.n33*e+this.n34*g;a.w=this.n41*c+this.n42*b+this.n43*e+this.n44*g;return a},rotateAxis:function(a){var c=a.x,b=a.y,e=a.z;a.x=c*this.n11+b*this.n12+e*this.n13;a.y=c*this.n21+b*this.n22+e*this.n23;a.z=c*this.n31+b*this.n32+e*this.n33;a.normalize();return a},crossVector:function(a){var c=new THREE.Vector4();c.x=this.n11*a.x+this.n12*a.y+this.n13*a.z+this.n14*a.w;c.y=this.n21*a.x+this.n22*a.y+this.n23*a.z+this.n24*a.w;c.z=this.n31*a.x+this.n32*a.y+this.n33*a.z+this.n34*a.w;c.w=(a.w)?this.n41*a.x+this.n42*a.y+this.n43*a.z+this.n44*a.w:1;return c},multiply:function(a,c){var b=a.n11,e=a.n12,g=a.n13,f=a.n14,d=a.n21,h=a.n22,i=a.n23,j=a.n24,k=a.n31,o=a.n32,n=a.n33,l=a.n34,p=a.n41,q=a.n42,r=a.n43,s=a.n44,t=c.n11,v=c.n12,u=c.n13,B=c.n14,A=c.n21,D=c.n22,C=c.n23,F=c.n24,E=c.n31,I=c.n32,J=c.n33,G=c.n34,H=c.n41,L=c.n42,M=c.n43,K=c.n44;this.n11=b*t+e*A+g*E+f*H;this.n12=b*v+e*D+g*I+f*L;this.n13=b*u+e*C+g*J+f*M;this.n14=b*B+e*F+g*G+f*K;this.n21=d*t+h*A+i*E+j*H;this.n22=d*v+h*D+i*I+j*L;this.n23=d*u+h*C+i*J+j*M;this.n24=d*B+h*F+i*G+j*K;this.n31=k*t+o*A+n*E+l*H;this.n32=k*v+o*D+n*I+l*L;this.n33=k*u+o*C+n*J+l*M;this.n34=k*B+o*F+n*G+l*K;this.n41=p*t+q*A+r*E+s*H;this.n42=p*v+q*D+r*I+s*L;this.n43=p*u+q*C+r*J+s*M;this.n44=p*B+q*F+r*G+s*K;return this},multiplyToArray:function(a,c,b){this.multiply(a,c);b[0]=this.n11;b[1]=this.n21;b[2]=this.n31;b[3]=this.n41;b[4]=this.n12;b[5]=this.n22;b[6]=this.n32;b[7]=this.n42;b[8]=this.n13;b[9]=this.n23;b[10]=this.n33;b[11]=this.n43;b[12]=this.n14;b[13]=this.n24;b[14]=this.n34;b[15]=this.n44;return this},multiplySelf:function(a){this.multiply(this,a);return this},multiplyScalar:function(a){this.n11*=a;this.n12*=a;this.n13*=a;this.n14*=a;this.n21*=a;this.n22*=a;this.n23*=a;this.n24*=a;this.n31*=a;this.n32*=a;this.n33*=a;this.n34*=a;this.n41*=a;this.n42*=a;this.n43*=a;this.n44*=a;return this},determinant:function(){var a=this.n11,c=this.n12,b=this.n13,e=this.n14,g=this.n21,f=this.n22,d=this.n23,h=this.n24,i=this.n31,j=this.n32,k=this.n33,o=this.n34,n=this.n41,l=this.n42,p=this.n43,q=this.n44;return (e*d*j*n-b*h*j*n-e*f*k*n+c*h*k*n+b*f*o*n-c*d*o*n-e*d*i*l+b*h*i*l+e*g*k*l-a*h*k*l-b*g*o*l+a*d*o*l+e*f*i*p-c*h*i*p-e*g*j*p+a*h*j*p+c*g*o*p-a*f*o*p-b*f*i*q+c*d*i*q+b*g*j*q-a*d*j*q-c*g*k*q+a*f*k*q)},transpose:function(){var a;a=this.n21;this.n21=this.n12;this.n12=a;a=this.n31;this.n31=this.n13;this.n13=a;a=this.n32;this.n32=this.n23;this.n23=a;a=this.n41;this.n41=this.n14;this.n14=a;a=this.n42;this.n42=this.n24;this.n24=a;a=this.n43;this.n43=this.n34;this.n43=a;return this},clone:function(){var a=new THREE.Matrix4();a.n11=this.n11;a.n12=this.n12;a.n13=this.n13;a.n14=this.n14;a.n21=this.n21;a.n22=this.n22;a.n23=this.n23;a.n24=this.n24;a.n31=this.n31;a.n32=this.n32;a.n33=this.n33;a.n34=this.n34;a.n41=this.n41;a.n42=this.n42;a.n43=this.n43;a.n44=this.n44;return a},flatten:function(){this.flat[0]=this.n11;this.flat[1]=this.n21;this.flat[2]=this.n31;this.flat[3]=this.n41;this.flat[4]=this.n12;this.flat[5]=this.n22;this.flat[6]=this.n32;this.flat[7]=this.n42;this.flat[8]=this.n13;this.flat[9]=this.n23;this.flat[10]=this.n33;this.flat[11]=this.n43;this.flat[12]=this.n14;this.flat[13]=this.n24;this.flat[14]=this.n34;this.flat[15]=this.n44;return this.flat},flattenToArray:function(a){a[0]=this.n11;a[1]=this.n21;a[2]=this.n31;a[3]=this.n41;a[4]=this.n12;a[5]=this.n22;a[6]=this.n32;a[7]=this.n42;a[8]=this.n13;a[9]=this.n23;a[10]=this.n33;a[11]=this.n43;a[12]=this.n14;a[13]=this.n24;a[14]=this.n34;a[15]=this.n44;return a},flattenToArrayOffset:function(a,c){a[c]=this.n11;a[c+1]=this.n21;a[c+2]=this.n31;a[c+3]=this.n41;a[c+4]=this.n12;a[c+5]=this.n22;a[c+6]=this.n32;a[c+7]=this.n42;a[c+8]=this.n13;a[c+9]=this.n23;a[c+10]=this.n33;a[c+11]=this.n43;a[c+12]=this.n14;a[c+13]=this.n24;a[c+14]=this.n34;a[c+15]=this.n44;return a},setTranslation:function(a,c,b){this.set(1,0,0,a,0,1,0,c,0,0,1,b,0,0,0,1);return this},setScale:function(a,c,b){this.set(a,0,0,0,0,c,0,0,0,0,b,0,0,0,0,1);return this},setRotationX:function(a){var c=Math.cos(a),b=Math.sin(a);this.set(1,0,0,0,0,c,-b,0,0,b,c,0,0,0,0,1);return this},setRotationY:function(a){var c=Math.cos(a),b=Math.sin(a);this.set(c,0,b,0,0,1,0,0,-b,0,c,0,0,0,0,1);return this},setRotationZ:function(a){var c=Math.cos(a),b=Math.sin(a);this.set(c,-b,0,0,b,c,0,0,0,0,1,0,0,0,0,1);return this},setRotationAxis:function(a,c){var b=Math.cos(c),e=Math.sin(c),g=1-b,f=a.x,d=a.y,h=a.z,i=g*f,j=g*d;this.set(i*f+b,i*d-e*h,i*h+e*d,0,i*d+e*h,j*d+b,j*h-e*f,0,i*h-e*d,j*h+e*f,g*h*h+b,0,0,0,0,1);return this},setPosition:function(a){this.n14=a.x;this.n24=a.y;this.n34=a.z;return this},getPosition:function(){if(!this.position){this.position=new THREE.Vector3()}this.position.set(this.n14,this.n24,this.n34);return this.position},getColumnX:function(){if(!this.columnX){this.columnX=new THREE.Vector3()}this.columnX.set(this.n11,this.n21,this.n31);return this.columnX},getColumnY:function(){if(!this.columnY){this.columnY=new THREE.Vector3()}this.columnY.set(this.n12,this.n22,this.n32);return this.columnY},getColumnZ:function(){if(!this.columnZ){this.columnZ=new THREE.Vector3()}this.columnZ.set(this.n13,this.n23,this.n33);return this.columnZ},setRotationFromEuler:function(a,c){var b=a.x,e=a.y,g=a.z,f=Math.cos(b),d=Math.sin(b),h=Math.cos(e),i=Math.sin(e),j=Math.cos(g),k=Math.sin(g);switch(c){case 'YXZ':var o=h*j,n=h*k,l=i*j,p=i*k;this.n11=o+p*d;this.n12=l*d-n;this.n13=f*i;this.n21=f*k;this.n22=f*j;this.n23=-d;this.n31=n*d-l;this.n32=p+o*d;this.n33=f*h;break;case 'ZXY':var o=h*j,n=h*k,l=i*j,p=i*k;this.n11=o-p*d;this.n12=-f*k;this.n13=l+n*d;this.n21=n+l*d;this.n22=f*j;this.n23=p-o*d;this.n31=-f*i;this.n32=d;this.n33=f*h;break;case 'ZYX':var q=f*j,r=f*k,s=d*j,t=d*k;this.n11=h*j;this.n12=s*i-r;this.n13=q*i+t;this.n21=h*k;this.n22=t*i+q;this.n23=r*i-s;this.n31=-i;this.n32=d*h;this.n33=f*h;break;case 'YZX':var v=f*h,u=f*i,B=d*h,A=d*i;this.n11=h*j;this.n12=A-v*k;this.n13=B*k+u;this.n21=k;this.n22=f*j;this.n23=-d*j;this.n31=-i*j;this.n32=u*k+B;this.n33=v-A*k;break;case 'XZY':var v=f*h,u=f*i,B=d*h,A=d*i;this.n11=h*j;this.n12=-k;this.n13=i*j;this.n21=v*k+A;this.n22=f*j;this.n23=u*k-B;this.n31=B*k-u;this.n32=d*j;this.n33=A*k+v;break;default :var q=f*j,r=f*k,s=d*j,t=d*k;this.n11=h*j;this.n12=-h*k;this.n13=i;this.n21=r+s*i;this.n22=q-t*i;this.n23=-d*h;this.n31=t-q*i;this.n32=s+r*i;this.n33=f*h;break}return this},setRotationFromQuaternion:function(a){var c=a.x,b=a.y,e=a.z,g=a.w,f=c+c,d=b+b,h=e+e,i=c*f,j=c*d,k=c*h,o=b*d,n=b*h,l=e*h,p=g*f,q=g*d,r=g*h;this.n11=1-(o+l);this.n12=j-r;this.n13=k+q;this.n21=j+r;this.n22=1-(i+l);this.n23=n-p;this.n31=k-q;this.n32=n+p;this.n33=1-(i+o);return this},scale:function(a){var c=a.x,b=a.y,e=a.z;this.n11*=c;this.n12*=b;this.n13*=e;this.n21*=c;this.n22*=b;this.n23*=e;this.n31*=c;this.n32*=b;this.n33*=e;this.n41*=c;this.n42*=b;this.n43*=e;return this},compose:function(a,c,b){var e=THREE.Matrix4.__m1,g=THREE.Matrix4.__m2;e.identity();e.setRotationFromQuaternion(c);g.setScale(b.x,b.y,b.z);this.multiply(e,g);this.n14=a.x;this.n24=a.y;this.n34=a.z;return this},decompose:function(a,c,b){var e=THREE.Matrix4.__v1,g=THREE.Matrix4.__v2,f=THREE.Matrix4.__v3;e.set(this.n11,this.n21,this.n31);g.set(this.n12,this.n22,this.n32);f.set(this.n13,this.n23,this.n33);a=(a instanceof THREE.Vector3)?a:new THREE.Vector3();c=(c instanceof THREE.Quaternion)?c:new THREE.Quaternion();b=(b instanceof THREE.Vector3)?b:new THREE.Vector3();b.x=e.length();b.y=g.length();b.z=f.length();a.x=this.n14;a.y=this.n24;a.z=this.n34;var d=THREE.Matrix4.__m1;d.copy(this);d.n11/=b.x;d.n21/=b.x;d.n31/=b.x;d.n12/=b.y;d.n22/=b.y;d.n32/=b.y;d.n13/=b.z;d.n23/=b.z;d.n33/=b.z;c.setFromRotationMatrix(d);return [a,c,b]},extractPosition:function(a){this.n14=a.n14;this.n24=a.n24;this.n34=a.n34},extractRotation:function(a,c){var b=1/c.x,e=1/c.y,g=1/c.z;this.n11=a.n11*b;this.n21=a.n21*b;this.n31=a.n31*b;this.n12=a.n12*e;this.n22=a.n22*e;this.n32=a.n32*e;this.n13=a.n13*g;this.n23=a.n23*g;this.n33=a.n33*g}};THREE.Matrix4.makeInvert=function(a,c){var b=a.n11,e=a.n12,g=a.n13,f=a.n14,d=a.n21,h=a.n22,i=a.n23,j=a.n24,k=a.n31,o=a.n32,n=a.n33,l=a.n34,p=a.n41,q=a.n42,r=a.n43,s=a.n44;if(c===undefined)c=new THREE.Matrix4();c.n11=i*l*q-j*n*q+j*o*r-h*l*r-i*o*s+h*n*s;c.n12=f*n*q-g*l*q-f*o*r+e*l*r+g*o*s-e*n*s;c.n13=g*j*q-f*i*q+f*h*r-e*j*r-g*h*s+e*i*s;c.n14=f*i*o-g*j*o-f*h*n+e*j*n+g*h*l-e*i*l;c.n21=j*n*p-i*l*p-j*k*r+d*l*r+i*k*s-d*n*s;c.n22=g*l*p-f*n*p+f*k*r-b*l*r-g*k*s+b*n*s;c.n23=f*i*p-g*j*p-f*d*r+b*j*r+g*d*s-b*i*s;c.n24=g*j*k-f*i*k+f*d*n-b*j*n-g*d*l+b*i*l;c.n31=h*l*p-j*o*p+j*k*q-d*l*q-h*k*s+d*o*s;c.n32=f*o*p-e*l*p-f*k*q+b*l*q+e*k*s-b*o*s;c.n33=g*j*p-f*h*p+f*d*q-b*j*q-e*d*s+b*h*s;c.n34=f*h*k-e*j*k-f*d*o+b*j*o+e*d*l-b*h*l;c.n41=i*o*p-h*n*p-i*k*q+d*n*q+h*k*r-d*o*r;c.n42=e*n*p-g*o*p+g*k*q-b*n*q-e*k*r+b*o*r;c.n43=g*h*p-e*i*p-g*d*q+b*i*q+e*d*r-b*h*r;c.n44=e*i*k-g*h*k+g*d*o-b*i*o-e*d*n+b*h*n;c.multiplyScalar(1/a.determinant());return c};THREE.Matrix4.makeInvert3x3=function(a){var c=a.m33,b=c.m,e=a.n33*a.n22-a.n32*a.n23,g=-a.n33*a.n21+a.n31*a.n23,f=a.n32*a.n21-a.n31*a.n22,d=-a.n33*a.n12+a.n32*a.n13,h=a.n33*a.n11-a.n31*a.n13,i=-a.n32*a.n11+a.n31*a.n12,j=a.n23*a.n12-a.n22*a.n13,k=-a.n23*a.n11+a.n21*a.n13,o=a.n22*a.n11-a.n21*a.n12,n=a.n11*e+a.n21*d+a.n31*j,l;if(n==0){console.error('THREE.Matrix4.makeInvert3x3: Matrix not invertible.')}l=1.0/n;b[0]=l*e;b[1]=l*g;b[2]=l*f;b[3]=l*d;b[4]=l*h;b[5]=l*i;b[6]=l*j;b[7]=l*k;b[8]=l*o;return c};THREE.Matrix4.makeFrustum=function(a,c,b,e,g,f){var d,h,i,j,k,o,n;d=new THREE.Matrix4();h=2*g/(c-a);i=2*g/(e-b);j=(c+a)/(c-a);k=(e+b)/(e-b);o=-(f+g)/(f-g);n=-2*f*g/(f-g);d.n11=h;d.n12=0;d.n13=j;d.n14=0;d.n21=0;d.n22=i;d.n23=k;d.n24=0;d.n31=0;d.n32=0;d.n33=o;d.n34=n;d.n41=0;d.n42=0;d.n43=-1;d.n44=0;return d};THREE.Matrix4.makePerspective=function(a,c,b,e){var g,f,d,h;g=b*Math.tan(a*Math.PI/360);f=-g;d=f*c;h=g*c;return THREE.Matrix4.makeFrustum(d,h,f,g,b,e)};THREE.Matrix4.makeOrtho=function(a,c,b,e,g,f){var d,h,i,j,k,o,n;d=new THREE.Matrix4();k=c-a;o=b-e;n=f-g;h=(c+a)/k;i=(b+e)/o;j=(f+g)/n;d.n11=2/k;d.n12=0;d.n13=0;d.n14=-h;d.n21=0;d.n22=2/o;d.n23=0;d.n24=-i;d.n31=0;d.n32=0;d.n33=-2/n;d.n34=-j;d.n41=0;d.n42=0;d.n43=0;d.n44=1;return d};THREE.Matrix4.__v1=new THREE.Vector3();THREE.Matrix4.__v2=new THREE.Vector3();THREE.Matrix4.__v3=new THREE.Vector3();THREE.Matrix4.__m1=new THREE.Matrix4();THREE.Matrix4.__m2=new THREE.Matrix4();